

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4.3. Arrays &#8212; Real-time DSP Notes</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ch4/arrays';</script>
    <link rel="shortcut icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.4. Math Data Types" href="math.html" />
    <link rel="prev" title="4.2. Loops" href="loops.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Real-Time DSP Applications
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch1/overview.html">1. Overview</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch1/rfsoc4x2.html">1.1. Hardware Platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/vitis.html">1.2. Software Development Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/workflow.html">1.3. Vitis Application Acceleration Development</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch2/hls.html">2. Introduction to HLS</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch2/hls_tasks.html">2.1. HLS Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/hls_flow.html">2.2. Vitis HLS Development Flow</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch3/hls_design.html">3. HLS Design Basics</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch3/metrics.html">3.1. Performance Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/model.html">3.2. Producer-Consumer Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/deadlock.html">3.3. Deadlock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/dataflow.html">3.4. Data Flow Graph Execution</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="hls_prog.html">4. HLS Programming</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="functions.html">4.1. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="loops.html">4.2. Loops</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">4.3. Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="math.html">4.4. Math Data Types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ch5/hls_intf.html">5. HLS Kernel Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refs.html">6. References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/tanfwong/rfsoc_notes" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/tanfwong/rfsoc_notes/issues/new?title=Issue%20on%20page%20%2Fch4/arrays.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/ch4/arrays.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Arrays</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#array-access-performance">4.3.1. Array Access Performance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#array-partitioning">4.3.1.1. Array Partitioning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#array-reshaping">4.3.1.2. Array Reshaping</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#array-initialization-and-reset">4.3.2. Array Initialization and Reset</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="arrays">
<span id="sec-arrays"></span><h1><span class="section-number">4.3. </span>Arrays<a class="headerlink" href="#arrays" title="Permalink to this headline">#</a></h1>
<ul>
<li><p>Vitis HLS implements arrays (except for array arguments of the
top-level function) as some type of memory during synthesis. The
types of memory supported include, RAM (<code class="docutils literal notranslate"><span class="pre">RAM_1P</span></code>, <code class="docutils literal notranslate"><span class="pre">RAM_1WNR</span></code>,
<code class="docutils literal notranslate"><span class="pre">RAM_2P</span></code>, <code class="docutils literal notranslate"><span class="pre">RAM_S2P</span></code>, <code class="docutils literal notranslate"><span class="pre">RAM_T2P</span></code>), ROM (<code class="docutils literal notranslate"><span class="pre">ROM_1P</span></code>, <code class="docutils literal notranslate"><span class="pre">ROM_2P</span></code>,
<code class="docutils literal notranslate"><span class="pre">ROM_NP</span></code>), and shift registers (<code class="docutils literal notranslate"><span class="pre">FIFO</span></code>).  More detailed
descriptions about these different types of memory can be found
from the manual of <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1399-vitis-hls/pragma-HLS-bind_storage"><code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">HLS</span>&#160; <span class="pre">bind_storage</span></code></a>. Each
of these types of memory can be implemented using different PL
resources, such as block RAM, URAM, and CLBs.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Since arrays are synthesized as memory, they can only be
instantiated in the C/C++ code with sizes known during
synthesis.</p>
</div>
</li>
<li><p>By default, Vitis HLS automatically decides the type of memory to
synthesize an array into as well as the suitable PL resource to
implement the selected type of memory. For example, if the Vitis HLS
infers that an array is ether read or written only once per
iteration in a loop, then it synthesizes the array as a single-port
RAM (<code class="docutils literal notranslate"><span class="pre">RAM_1P</span></code>), and if the array size is small, Vitis HLS (actually
Vivado) implements the single-port RAM will be implemented using
CLBs in the PL. We may override Vitis HLS by using the bind-storage
pragma.</p></li>
<li><p>Array arguments of the top-level function in a DSP kernel are mapped
according to <a class="reference internal" href="functions.html#top-func-args"><span class="std std-numref">Table 4.1</span></a> and will be discussed in
a later section.</p></li>
</ul>
<section id="array-access-performance">
<h2><span class="section-number">4.3.1. </span>Array Access Performance<a class="headerlink" href="#array-access-performance" title="Permalink to this headline">#</a></h2>
<ul>
<li><p>Let us recall the simple  loop-unrolling example in <a class="reference internal" href="loops.html#sec-loop-unroll"><span class="std std-numref">Section 4.2.2</span></a>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="nl">Loop</span><span class="p">:</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="cp">#pragma HLS unroll </span>
<span class="w">  </span><span class="n">acc</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Vitis HLS synthesizes the array <code class="docutils literal notranslate"><span class="pre">x</span></code> into a two-port RAM. Since only two
reads from the RAM can be made in each clock cycle, it takes 5 clock
cycles to read the 10 elements in <code class="docutils literal notranslate"><span class="pre">x</span></code> even though <code class="docutils literal notranslate"><span class="pre">Loop</span></code> is unrolled
into a binary adder tree that can perform the accumulation of the
10 elements in just a single clock cycle. Indeed, reading from the
array <code class="docutils literal notranslate"><span class="pre">x</span></code> is in fact the bottleneck of performance in this case.</p>
</li>
<li><p>Vitis HLS provides two optimizations to solve array access
bottleneck problems similar to the one in the example above:</p>
<dl class="glossary simple">
<dt id="term-Array-Partitioning">Array Partitioning<a class="headerlink" href="#term-Array-Partitioning" title="Permalink to this term">#</a></dt><dd><p>An array is partitioned into smaller arrays or individual
elements, effectively increasing the number of read and write ports
to the original array.</p>
</dd>
<dt id="term-Array-Reshaping">Array Reshaping<a class="headerlink" href="#term-Array-Reshaping" title="Permalink to this term">#</a></dt><dd><p>Multiple elements in an array are concatenated to a single element
with an increased bit-width, allowing more elements in the
original array to be accessed in a single clock cycle.</p>
</dd>
</dl>
</li>
</ul>
<section id="array-partitioning">
<h3><span class="section-number">4.3.1.1. </span>Array Partitioning<a class="headerlink" href="#array-partitioning" title="Permalink to this headline">#</a></h3>
<ul>
<li><p>An array can be partitioned by using <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1399-vitis-hls/pragma-HLS-array_partition"><code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">HLS</span> <span class="pre">array_parition</span></code></a>.</p>
<ul>
<li><p>There are three types of ways to partition an array that can be
specified by the <code class="docutils literal notranslate"><span class="pre">type=</span></code> option in the array-partition pragma:</p>
<dl class="glossary simple">
<dt id="term-cyclic"><code class="docutils literal notranslate"><span class="pre">cyclic</span></code><a class="headerlink" href="#term-cyclic" title="Permalink to this term">#</a></dt><dd><p>One element is put into each new smaller array before coming back to the
first array to repeat the cycle until the array is fully partitioned.</p>
</dd>
<dt id="term-block"><code class="docutils literal notranslate"><span class="pre">block</span></code><a class="headerlink" href="#term-block" title="Permalink to this term">#</a></dt><dd><p>Smaller arrays are formed from consecutive blocks of the original array.</p>
</dd>
<dt id="term-complete"><code class="docutils literal notranslate"><span class="pre">complete</span></code><a class="headerlink" href="#term-complete" title="Permalink to this term">#</a></dt><dd><p>The original array is decomposed into individual elements, each of
which is synthesized into a register.</p>
</dd>
</dl>
</li>
<li><p>The number of smaller arrays into which the original array is
partitioned can be specified by the option <code class="docutils literal notranslate"><span class="pre">factor=</span></code> for the cases
of <code class="docutils literal notranslate"><span class="pre">type=cyclic</span></code> and <code class="docutils literal notranslate"><span class="pre">type=block</span></code>. See the figure below for
illustrative examples of the three types of array partitioning:</p>
<figure class="align-center" id="array-partition">
<a class="reference internal image-reference" href="../_images/array_partition.png"><img alt="Examples of array partitioning" src="../_images/array_partition.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4.1 </span><span class="caption-text">Examples of the three different types of array partitioning where
the option <code class="docutils literal notranslate"><span class="pre">factor=2</span></code> is set for the cases of <code class="docutils literal notranslate"><span class="pre">type=block</span></code> and
<code class="docutils literal notranslate"><span class="pre">type=cyclic</span></code> (image taken from <span id="id1">[<a class="reference internal" href="../refs.html#id12" title="Vitis High-Level Synthesis User Guide. AMD-Xilinx, Dec. 2023. UG1399 (v2023.2). URL: https://docs.xilinx.com/r/en-US/ug1399-vitis-hls.">AMD-Xilinx23a</a>]</span>)</span><a class="headerlink" href="#array-partition" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</li>
<li><p>For a multi-dimensional array, the <code class="docutils literal notranslate"><span class="pre">dim=</span></code> option can be used to
specify the dimension for which the array should be
partitioned. Setting <code class="docutils literal notranslate"><span class="pre">dim=0</span></code> partitions all dimensions.</p></li>
</ul>
</li>
<li><p>Array partitioning clearly improves array access (and hence latency
and throughput) in the expense of using more PL resources. For
example, consider completely partitoning the array <code class="docutils literal notranslate"><span class="pre">x</span></code> in the
previous example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="cp">#pragma HLS array_partition variable=x type=complete</span>

<span class="nl">Loop</span><span class="p">:</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="cp">#pragma HLS unroll </span>
<span class="w">  </span><span class="n">acc</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ten registers are synthesized for the 10 elements of <code class="docutils literal notranslate"><span class="pre">x</span></code>. Reading
from the 10 registers and accumulating through the adder tree
generated form unrolling <code class="docutils literal notranslate"><span class="pre">Loop</span></code> can all be done in parallel with a
single clock cycle! The 10 registers with array partitioning and
two-port RAM without are both implemented using CLB
resource. Implementation of the former requires more resource.</p>
</li>
</ul>
</section>
<section id="array-reshaping">
<h3><span class="section-number">4.3.1.2. </span>Array Reshaping<a class="headerlink" href="#array-reshaping" title="Permalink to this headline">#</a></h3>
<ul>
<li><p>An array can be reshaped by using <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1399-vitis-hls/pragma-HLS-array_reshape"><code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">HLS</span> <span class="pre">array_reshape</span></code></a>.</p>
<ul>
<li><p>The same three types of array partitioning are also available for
array reshaping with the elements of the original array placed in
different sections of bits in an element of the reshaped array as
illustrated by the examples shown in the following figure:</p>
<figure class="align-center" id="array-reshape">
<a class="reference internal image-reference" href="../_images/array_reshape.png"><img alt="Examples of array reshaping" src="../_images/array_reshape.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4.2 </span><span class="caption-text">Examples of the three different types of array reshaping where
the option <code class="docutils literal notranslate"><span class="pre">factor=2</span></code> is set for the cases of <code class="docutils literal notranslate"><span class="pre">type=block</span></code> and
<code class="docutils literal notranslate"><span class="pre">type=cyclic</span></code> (image taken from <span id="id2">[<a class="reference internal" href="../refs.html#id12" title="Vitis High-Level Synthesis User Guide. AMD-Xilinx, Dec. 2023. UG1399 (v2023.2). URL: https://docs.xilinx.com/r/en-US/ug1399-vitis-hls.">AMD-Xilinx23a</a>]</span>)</span><a class="headerlink" href="#array-reshape" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</li>
<li><p>For a multi-dimensional array, the <code class="docutils literal notranslate"><span class="pre">dim=</span></code> option can be used to
specify the dimension for which the array should be
reshaped. Setting <code class="docutils literal notranslate"><span class="pre">dim=0</span></code> reshapes all dimensions.</p></li>
</ul>
</li>
<li><p>If block RAM is chosen to be the PL resource to implement an array,
array reshaping can reduce the number of block RAM consumed compared
to array partitioning. However, array reshaping may not be as
beneficial when <code class="docutils literal notranslate"><span class="pre">type=complete</span></code> because the whole original array is read/or
write as a single element and extra logic and registers are needed to access the
individual sections of the element. For example, doing</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="cp">#pragma HLS array_reshape variable=x type=complete</span>

<span class="nl">Loop</span><span class="p">:</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">n</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="cp">#pragma HLS unroll </span>
<span class="n">acc</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>gives the same latency for the unrolled loop <code class="docutils literal notranslate"><span class="pre">Loop</span></code> as array
partitioning but requires more CBN resource to implement the reshaping.</p>
</li>
</ul>
</section>
</section>
<section id="array-initialization-and-reset">
<h2><span class="section-number">4.3.2. </span>Array Initialization and Reset<a class="headerlink" href="#array-initialization-and-reset" title="Permalink to this headline">#</a></h2>
<ul>
<li><p>The standard C++ convention dictates that the elements of an array
declared within a local scope (e.g., within a function) are not
initialized. This convention carries over to Vitis HLS.</p></li>
<li><p>If we want to initialize an array, we may use the standard C++ array
initialization syntax to do so, e.g.,</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">};</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li><p>Initializing an array as in the example above requires clock cycles
to write to the array elements to memory. If the array <code class="docutils literal notranslate"><span class="pre">x</span></code> is
declared (and initialized) with a function and the function is
called multiple times, then the extra clock cycles consumed on
initializing <code class="docutils literal notranslate"><span class="pre">x</span></code> are needed for each call to the function.</p></li>
<li><p>We may save those extra array initialization clock cycles by using
the qualifier <code class="docutils literal notranslate"><span class="pre">static</span></code> to declare the array, e.g.,</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">};</span>
</pre></div>
</div>
<p>Vitis HLS interprets a <code class="docutils literal notranslate"><span class="pre">static</span></code> array in the same way as in
standard C++ that the values of the array elements are preserved
across function calls. In this way, declaring a static array helps
to better match the behavior of the C++ code with that of hardware
memory that implements the array.</p>
</li>
<li><p>An additional advantage of declaring a static array is that Vitis
HLS can hard-code the initialization of its elements into the RTL
design so that no extra write clock cycles are needed.</p></li>
</ul>
</div>
</li>
<li><p>By default, Vitis HLS does not reset static arrays when a hardware
reset signal is asserted during execution (it does so for a power-on
reset though). This is done to avoid adding extra reset logic for
the implementation of the static arrays and the extra
initialization clock cycles needed. We can overide this default
configuration on a per array basis by using <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1399-vitis-hls/pragma-HLS-reset"><code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">HLS</span> <span class="pre">reset</span></code></a>.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ch4"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="loops.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">4.2. </span>Loops</p>
      </div>
    </a>
    <a class="right-next"
       href="math.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">4.4. </span>Math Data Types</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#array-access-performance">4.3.1. Array Access Performance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#array-partitioning">4.3.1.1. Array Partitioning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#array-reshaping">4.3.1.2. Array Reshaping</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#array-initialization-and-reset">4.3.2. Array Initialization and Reset</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tan F. Wong
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>